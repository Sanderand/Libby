<template name="patron">
  <section class="pad">
    <div>
      {{#if eqMode "VIEW"}}
        <a href="/app/patrons/"><button class="btn btn-default">Back</button></a>
        <button class="btn btn-primary enter-form-mode">Edit</button>
      {{/if}}

      {{#if eqMode "FORM"}}
        <button class="btn btn-default enter-view-mode">Abort</button>
        <button class="btn btn-success save-changes">Save</button>
        {{#if patron._id}}
          <button class="btn btn-danger delete-patron">Delete</button>
        {{/if}}
      {{/if}}
    </div>

    <div class="whitespace"></div>

    <!-- VIEW -->

    {{#if eqMode "VIEW"}}
      <div class="card">
        <h4>{{patron.first_name}} {{patron.last_name}}</h4>

        <div class="row">
          <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
            {{#if patron.email}}
              <p>
                <span class="glyphicon glyphicon-envelope pad-right-sm"></span>
                <a href="mailto:{{patron.email}}">{{patron.email}}</a>
              </p>
            {{/if}}
            {{#if patron.phone}}
            <p>
              <span class="glyphicon glyphicon-earphone pad-right-sm"></span>
              <a href="call:{{patron.phone}}">{{patron.phone}}</a>
            </p>
            {{/if}}
          </div>

          <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
            {{#if inlineAddress patron.address}}
            <p>
              <span class="glyphicon glyphicon-map-marker pad-right-sm"></span>
              <span>{{inlineAddress patron.address}}</span>
            </p>
            {{/if}}
            {{#if patron.notes}}
            <p>
              <span class="glyphicon glyphicon-comment pad-right-sm"></span>
              <span>{{patron.notes}}</span>
            </p>
            {{/if}}
          </div>
        </div>
      </div>

      <div class="card">
        <h4>Rented publications</h4>

        {{#if rentedPublications.count}}
          {{#each rentedPublications}}
            <div class="flex-row">
              <div class="pad">
                <span class="bullet">{{inc @index}}</span>
              </div>

              <div class="flex-max pad">
                <div><a href="/app/publications/{{_id}}">{{author}}: {{title}}</a></div>
                <div>Rented until {{formatDate rent.end_at 'DD.MM.YYYY'}}</div>
              </div>

              <div class="pad">
                <div class="btn btn-sm btn-warning publication-extend" data-id={{_id}}>Extend</div>
                <div class="btn btn-sm btn-primary publication-return" data-id={{_id}}>Return</div>
              </div>
            </div>
          {{/each}}
        {{else}}
          <p>No publications rented at the moment</p>
        {{/if}}
      </div>
    {{/if}}

    <!-- FORM -->

    {{#if eqMode "FORM"}}
      <div class="card">
        <h4 class="text-light">Person</h4>

        <div class="row">
          <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
            <label>First Name</label>
            <input class="form-control" type="text" name="first_name" value={{patron.first_name}}>
          </div>

          <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
            <label>Last Name</label>
            <input class="form-control" type="text" name="last_name" value={{patron.last_name}}>
          </div>
        </div>

        <div class="row">
          <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
            <label>Email</label>
            <input class="form-control" type="text" name="email" value={{patron.email}}>
          </div>

          <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
            <label>Phone</label>
            <input class="form-control" type="text" name="phone" value={{patron.phone}}>
          </div>
        </div>
      </div>

      <div class="card">
        <h4 class="text-light">Address</h4>

        <div class="row">
          <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
            <label>Street</label>
            <input class="form-control" type="text" name="street" value={{patron.address.street}}>
          </div>

          <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
            <label>Postal Code</label>
            <input class="form-control" type="text" name="postal_code" value={{patron.address.postal_code}}>
          </div>
        </div>

        <div class="row">
          <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
            <label>City</label>
            <input class="form-control" type="text" name="city" value={{patron.address.city}}>
          </div>
        </div>
      </div>

      <div class="card">
        <h4 class="text-light">Notes</h4>

        <div class="form-group">
          <textarea class="form-control" rows="3" name="notes">{{patron.notes}}</textarea>
        </div>
      </div>
    {{/if}}

  </section>
</template>
